<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Trading Journal</title>
<style>
  * { box-sizing: border-box; }
  body {
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    margin: 2em auto;
    max-width: 900px;
    background: #f0f4f8;
    color: #222;
    padding: 1em;
  }
  h1 {
    color: #2c3e50;
    text-align: center;
    margin-bottom: 1rem;
  }
  form {
    background: #fff;
    padding: 1em 1.5em;
    border-radius: 8px;
    box-shadow: 0 2px 8px rgba(44, 62, 80, 0.1);
    margin-bottom: 2em;
  }
  label {
    display: block;
    margin-top: 0.8em;
    font-weight: 600;
  }
  input, select, textarea {
    width: 100%;
    padding: 0.5em;
    margin-top: 0.2em;
    border-radius: 4px;
    border: 1px solid #ccd6dd;
    font-size: 1rem;
  }
  textarea { resize: vertical; min-height: 60px; }
  button {
    margin-top: 1.2em;
    background: #2980b9;
    color: white;
    border: none;
    padding: 0.75em 1.2em;
    cursor: pointer;
    border-radius: 6px;
    font-size: 1rem;
    transition: background-color 0.3s ease;
  }
  button:hover { background: #1c5980; }
  .summary {
    background: #fff;
    padding: 1em 1.5em;
    border-radius: 8px;
    box-shadow: 0 2px 12px rgba(41, 128, 185, 0.15);
    margin-bottom: 2em;
    font-size: 1.1rem;
    font-weight: 600;
    text-align: center;
  }
  table {
    border-collapse: collapse;
    width: 100%;
    background: #fff;
    border-radius: 8px;
    overflow: hidden;
    box-shadow: 0 3px 12px rgba(44, 62, 80, 0.1);
    font-size: 0.95rem;
  }
  thead { background: #2980b9; color: white; }
  th, td {
    padding: 0.75em 1em;
    text-align: center;
    border-bottom: 1px solid #e1e8ed;
    vertical-align: middle;
  }
  tbody tr:hover { background-color: #eef6fb; }
  .delete-btn {
    background: #e74c3c;
    border: none;
    color: white;
    padding: 0.3em 0.6em;
    font-size: 0.8rem;
    border-radius: 4px;
    cursor: pointer;
    transition: background-color 0.3s ease;
  }
  .delete-btn:hover { background: #c0392b; }
  #equityChart {
    display: block;
    margin: 1.5em auto;
    max-width: 100%;
    border-radius: 8px;
    box-shadow: 0 2px 10px rgba(41, 128, 185, 0.2);
  }
  @media (min-width: 600px) {
    form label {
      display: inline-block;
      width: 32%;
      margin-right: 2%;
    }
    form label:nth-child(3n) { margin-right: 0; }
    input[type="datetime-local"] { width: 100%; }
    textarea { width: 100%; margin-top: 0.8em; }
  }
</style>
</head>
<body>
<h1>Stock Trading Journal</h1>

<form id="tradeForm">
  <label>Date/Time:<input type="datetime-local" name="date" required></label>
  <label>Ticker:<input type="text" name="ticker" required></label>
  <label>Buy/Sell:
    <select name="side">
      <option>Buy</option>
      <option>Sell</option>
    </select>
  </label>
  <label>Entry Price:<input type="number" name="entry" required step="0.01"></label>
  <label>Exit Price:<input type="number" name="exit" required step="0.01"></label>
  <label>Quantity:<input type="number" name="qty" required step="1"></label>
  <label>Market Context:<input type="text" name="context"></label>
  <label>Notes:<textarea name="notes"></textarea></label>
  <button type="submit">Add Trade</button>
</form>

<div class="summary" id="stats"></div>

<table id="tradeTable">
  <thead>
    <tr>
      <th>Date/Time</th>
      <th>Ticker</th>
      <th>Side</th>
      <th>Entry</th>
      <th>Exit</th>
      <th>Qty</th>
      <th>P/L</th>
      <th>Context</th>
      <th>Notes</th>
      <th>Actions</th>
    </tr>
  </thead>
  <tbody></tbody>
</table>

<canvas id="equityChart" height="250"></canvas>

<script>
let trades = JSON.parse(localStorage.getItem("trades") || "[]");

function saveTrades() {
  localStorage.setItem("trades", JSON.stringify(trades));
}

function updateStatsAndTable() {
  const tbody = document.querySelector("#tradeTable tbody");
  tbody.innerHTML = "";
  let wins = 0, losses = 0, equity = 0, curve = [];
  trades.forEach((tr, index) => {
    equity += tr.pnl;
    curve.push(equity);
    let row = `
      <tr>
        <td>${tr.date}</td>
        <td>${tr.ticker}</td>
        <td>${tr.side}</td>
        <td>${tr.entry}</td>
        <td>${tr.exit}</td>
        <td>${tr.qty}</td>
        <td style="color:${tr.pnl >= 0 ? '#27ae60' : '#e74c3c'}">${tr.pnl.toFixed(2)}</td>
        <td>${tr.context || ""}</td>
        <td>${tr.notes || ""}</td>
        <td><button class='delete-btn' data-index='${index}'>Delete</button></td>
      </tr>
    `;
    tbody.insertAdjacentHTML("beforeend", row);
    if (tr.pnl > 0) wins++;
    else if (tr.pnl < 0) losses++;
  });
  let stats = `Total trades: ${trades.length} | Wins: ${wins} | Losses: ${losses} | NET: <b>${equity.toFixed(2)}</b>`;
  document.getElementById("stats").innerHTML = stats;

  // Draw a smooth equity curve
  const ctx = document.getElementById('equityChart').getContext('2d');
  ctx.clearRect(0, 0, ctx.canvas.width, ctx.canvas.height);

  if(curve.length > 0) {
    const w = ctx.canvas.width, h = ctx.canvas.height;
    const maxEquity = Math.max(...curve);
    const minEquity = Math.min(...curve);
    const range = maxEquity - minEquity || 1;

    ctx.beginPath();
    ctx.strokeStyle = '#2980b9';
    ctx.lineWidth = 3;

    function smoothCurve(points) {
      ctx.moveTo(0, h - (points[0] - minEquity) / range * h);
      for (let i = 1; i < points.length; i++) {
        const x = i * w / (points.length - 1);
        const y = h - (points[i] - minEquity) / range * h;
        ctx.lineTo(x, y);
      }
    }
    smoothCurve(curve);
    ctx.stroke();
  }
}

// Add trade
document.getElementById("tradeForm").onsubmit = function(e) {
  e.preventDefault();
  let f = e.target.elements;
  let entry = Number(f.entry.value), exit = Number(f.exit.value), qty = Number(f.qty.value);
  let pnl = (f.side.value === "Buy" ? (exit - entry) : (entry - exit)) * qty;

  trades.push({
    date: f.date.value, ticker: f.ticker.value.toUpperCase(), side: f.side.value,
    entry, exit, qty, pnl,
    context: f.context.value, notes: f.notes.value
  });
  saveTrades();
  updateStatsAndTable();
  e.target.reset();
};

// Delete trade
document.querySelector("#tradeTable tbody").addEventListener("click", function(e) {
  if(e.target.classList.contains("delete-btn")) {
    const idx = e.target.getAttribute("data-index");
    trades.splice(idx, 1);
    saveTrades();
    updateStatsAndTable();
  }
});

updateStatsAndTable();
</script>
</body>
</html>
