<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Trading Journal</title>
<style>
  * { box-sizing: border-box; }
  body {
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    margin: 2em auto;
    max-width: 950px;
    background: #f0f4f8;
    color: #222;
    padding: 1em;
  }
  h1 { color: #2c3e50; text-align: center; margin-bottom: 1rem; }
  .row-flex { display: flex; flex-wrap: wrap; gap: 0.6em 1em; align-items: end; }
  form {
    background: #fff; padding: 1em 1.5em; border-radius: 8px;
    box-shadow: 0 2px 8px rgba(44,62,80,0.1); margin-bottom: 1.5em;
  }
  label { display: block; margin-top: 1em; font-weight: 600; flex: 1 1 210px; min-width: 140px; }
  input, select, textarea { width: 100%; padding: 0.5em; margin-top: 0.2em; border-radius: 4px; border: 1px solid #ccd6dd; font-size: 1rem; }
  textarea { resize: vertical; min-height: 54px; }
  .buttons-bar { margin: 1.5em 0 .3em 0; display: flex; gap: 1.1em; flex-wrap: wrap; }
  button { background: #2980b9; color: white; border: none; padding: 0.60em 1.1em; cursor: pointer; border-radius: 6px; font-size: 1rem; transition: background 0.26s; }
  button:hover { background: #1c5980; }
  .small-btn { padding: 0.35em 0.7em; font-size: 0.93rem; border-radius: 4px; margin-left: 0.3em; }
  .del-btn { background: #e74c3c; }
  .del-btn:hover { background: #c0392b; }
  .clear-btn { background: #bbb; color: #333; }
  .clear-btn:hover { background: #888; color: white; }
  .summary {
    background: #fff; padding: 1em 1.5em; border-radius: 8px;
    box-shadow: 0 2px 12px rgba(41,128,185,0.15); margin-bottom: 1.6em;
    font-size: 1.1rem; font-weight: 600; text-align: center;
  }
  table {
    border-collapse: collapse; width: 100%; background: #fff; border-radius: 8px;
    box-shadow: 0 3px 12px rgba(44,62,80,0.10); font-size: 0.97rem; overflow: hidden;
  }
  thead { background: #2980b9; color: white; }
  th, td { padding: 0.7em 1em; text-align: center; border-bottom: 1px solid #e1e8ed; }
  tbody tr:hover { background-color: #eef6fb; }
  .delete-btn {
    background: #e74c3c; border: none; color: white; padding: 0.35em .72em;
    font-size: 0.86rem; border-radius: 4px; cursor: pointer; transition: background 0.25s;
  }
  .delete-btn:hover { background: #c0392b; }
  #equityChart {
    display: block; margin: 1.2em auto 0.6em auto; max-width: 100%;
    border-radius: 8px; box-shadow: 0 2px 10px rgba(41,128,185,0.20);
  }
  .tickers-list {
    margin: 1em 0 2em 0; text-align: center; color: #154a77;
    font-size: 1.07rem; background: #f8fafb; border-radius: 6px; padding: 0.5em .7em;
  }
  @media (max-width: 730px) {
    form, .summary, table { padding-left: 2vw; padding-right: 2vw; }
    .row-flex { flex-direction: column; gap: 0; }
    label { min-width: 0; }
  }
</style>
</head>
<body>
<h1>Stock Trading Journal</h1>

<form id="tradeForm" autocomplete="off">
  <div class="row-flex">
    <label>
      Date/Time:
      <div style="display:flex;gap:0.7em;">
        <input type="datetime-local" name="date" required id="dateInput" style="flex:1 1 75%">
        <button type="button" class="small-btn clear-btn" title="Set date/time to now" id="setTodayBtn">Today</button>
      </div>
    </label>
    <label>Ticker:<input type="text" name="ticker" required maxlength="8" style="text-transform:uppercase"></label>
    <label>Buy/Sell:<select name="side"><option>Buy</option><option>Sell</option></select></label>
    <label>Entry Price:<input type="number" name="entry" required step="0.01"></label>
    <label>Exit Price:<input type="number" name="exit" required step="0.01"></label>
    <label>Quantity:<input type="number" name="qty" required min="1" step="1"></label>
    <label>Market Context:<input type="text" name="context"></label>
  </div>
  <label>Notes:<textarea name="notes" maxlength="300"></textarea></label>
  <div style="text-align:right;">
    <button type="submit">Add Trade</button>
  </div>
</form>

<div class="buttons-bar">
  <button id="printBtn">Print Statement</button>
  <button id="clearAllBtn" class="clear-btn">Clear All Trades</button>
</div>

<div class="summary" id="stats"></div>

<table id="tradeTable">
  <thead>
    <tr>
      <th>Date/Time</th>
      <th>Ticker</th>
      <th>Side</th>
      <th>Entry</th>
      <th>Exit</th>
      <th>Qty</th>
      <th>P/L</th>
      <th>Context</th>
      <th>Notes</th>
      <th>Actions</th>
    </tr>
  </thead>
  <tbody></tbody>
</table>

<div class="tickers-list" id="tickersList"></div>

<canvas id="equityChart" height="250"></canvas>

<script>
let trades = JSON.parse(localStorage.getItem("trades") || "[]");

function saveTrades() {
  localStorage.setItem("trades", JSON.stringify(trades));
}

function updateStatsAndTable() {
  const tbody = document.querySelector("#tradeTable tbody");
  tbody.innerHTML = "";
  let wins = 0, losses = 0, equity = 0, curve = [];
  let tickerSet = new Set();
  trades.forEach((tr, index) => {
    equity += tr.pnl;
    curve.push(equity);
    tickerSet.add(tr.ticker);
    let row = `
      <tr>
        <td>${tr.date}</td>
        <td>${tr.ticker}</td>
        <td>${tr.side}</td>
        <td>${tr.entry}</td>
        <td>${tr.exit}</td>
        <td>${tr.qty}</td>
        <td style="color:${tr.pnl >= 0 ? '#27ae60' : '#e74c3c'}">${tr.pnl.toFixed(2)}</td>
        <td>${tr.context || ""}</td>
        <td>${tr.notes || ""}</td>
        <td><button class='delete-btn' data-index='${index}'>Delete</button></td>
      </tr>
    `;
    tbody.insertAdjacentHTML("beforeend", row);
    if (tr.pnl > 0) wins++;
    else if (tr.pnl < 0) losses++;
  });
  let stats = `Total trades: ${trades.length} | Wins: ${wins} | Losses: ${losses} | NET: <b>${equity.toFixed(2)}</b>`;
  document.getElementById("stats").innerHTML = stats;

  // Draw a smooth equity curve
  const ctx = document.getElementById('equityChart').getContext('2d');
  ctx.clearRect(0, 0, ctx.canvas.width, ctx.canvas.height);
  if(curve.length > 0) {
    ctx.beginPath();
    const w = ctx.canvas.width, h = ctx.canvas.height;
    const maxEquity = Math.max(...curve), minEquity = Math.min(...curve), range = maxEquity - minEquity || 1;
    ctx.strokeStyle = '#2980b9'; ctx.lineWidth = 3;
    ctx.moveTo(0, h - (curve[0] - minEquity) / range * h);
    for (let i = 1; i < curve.length; i++) {
      const x = i * w / (curve.length - 1);
      const y = h - (curve[i] - minEquity) / range * h;
      ctx.lineTo(x, y);
    }
    ctx.stroke();
  }

  // Unique tickers list
  let tickers = Array.from(tickerSet).sort();
  document.getElementById('tickersList').innerHTML =
    tickers.length > 0
      ? "All listed tickers: <b>" + tickers.join(", ") + "</b>"
      : "<i>No stocks traded yet.</i>";
}

// Add trade
document.getElementById("tradeForm").onsubmit = function(e) {
  e.preventDefault();
  let f = e.target.elements;
  let entry = Number(f.entry.value), exit = Number(f.exit.value), qty = Number(f.qty.value);
  let pnl = (f.side.value === "Buy" ? (exit - entry) : (entry - exit)) * qty;
  trades.push({
    date: f.date.value, ticker: f.ticker.value.toUpperCase(), side: f.side.value,
    entry, exit, qty, pnl,
    context: f.context.value, notes: f.notes.value
  });
  saveTrades();
  updateStatsAndTable();
  e.target.reset();
};

// Delete trade (row)
document.querySelector("#tradeTable tbody").addEventListener("click", function(e) {
  if(e.target.classList.contains("delete-btn")) {
    const idx = e.target.getAttribute("data-index");
    trades.splice(idx, 1);
    saveTrades();
    updateStatsAndTable();
  }
});

// Print statement
document.getElementById("printBtn").onclick = function() {
  window.print();
};

// Set Today/Now for date-time
document.getElementById("setTodayBtn").onclick = function() {
  let now = new Date();
  let tz = now.getTimezoneOffset() * 60000;
  let local = new Date(now - tz).toISOString().slice(0,16);
  document.getElementById("dateInput").value = local;
};

// Clear all trades
document.getElementById("clearAllBtn").onclick = function() {
  if(confirm("Clear ALL trades? This cannot be undone!")) {
    trades = [];
    saveTrades();
    updateStatsAndTable();
  }
};

// By default, set the date field to today/now on load:
window.addEventListener("DOMContentLoaded", () => {
  document.getElementById("setTodayBtn").click();
  updateStatsAndTable();
});
</script>
</body>
</html>
